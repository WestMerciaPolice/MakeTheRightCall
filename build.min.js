var GAME={url:"https://westmerciapolice.github.io/MakeTheRightCall",width:1024,height:768,scale:.75,isMobile:"ontouchstart"in window,preloadbar:[{name:"preload bar",src:"img/ui_preload-bar.png"}],fontStyle:{font:"bold 25px Arial",fill:"#FFFFFF",align:"center",strokeThickness:1},backgrounds:[{name:"title",src:"img/bg_title.jpg"},{name:"hints",src:"img/bg_hints.jpg"},{name:"play now",src:"img/btn_play-now.png"},{name:"hint btn",src:"img/btn_hints.png"},{name:"game bg",src:"img/bg_game.jpg"},{name:"header bg",src:"img/bg_header.png"},{name:"header red",src:"img/bg_header-red.png"},{name:"header green",src:"img/bg_header-green.png"},{name:"footer bg",src:"img/bg_footer.png"},{name:"footer red",src:"img/bg_footer-red.png"},{name:"target bg",src:"img/bg_target.png"},{name:"arrows",src:"img/bg_arrows.png"},{name:"start btn",src:"img/btn_start.png"},{name:"card",src:"img/bg_card.png"},{name:"caller",src:"img/ico_caller.png"},{name:"gameover",src:"img/bg_game-over.jpg"},{name:"facebook",src:"img/btn_facebook.png"},{name:"twitter",src:"img/btn_twitter.png"},{name:"play again",src:"img/btn_play-again.png"}],sounds:[{name:"office",src:"audio/office.mp3"},{name:"swoosh",src:"audio/swoosh.mp3"},{name:"click",src:"audio/click.mp3"},{name:"bell",src:"audio/bell.mp3"}],Screens:{},isRunning:!1};$=function(a){return document.querySelector(a)},GAME.Utils=function(){var a={loadImages:function(a){var b,c=a.length;for(b=0;c>b;b++)_.load.image(a[b].name,a[b].src)},loadSounds:function(a){var b,c=a.length;for(b=0;c>b;b++)_.load.audio(a[b].name,a[b].src)},randomRange:function(a,b){return Math.random()*(b-a+1)|0+a},merge:function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c},share:function(a,b,c){var d,e,f;"facebook"===a?(d=GAME.url+"?utm_source=facebook.com&utm_medium=social&utm_campaign=MTRC",e="I dealt with "+(b||0)+" calls in "+(c||0)+" seconds. Could you handle the pressure? How many calls can you deal with? Take your turn here: ",f="http://www.facebook.com/sharer.php?s=100&p[title]=West+Mercia+Police+MakeTheRightCall+Game&p[url]="+encodeURIComponent(d)+"&p[summary]="+encodeURIComponent(e+" #MakeTheRightCall")):"twitter"===a?(d=GAME.url+"?utm_source=twitter.com&utm_medium=social&utm_campaign=MTRC",e="I dealt with "+(b||0)+" calls in "+(c||0)+" seconds. Could you handle the pressure? How many can you deal with: "+d,f="https://twitter.com/intent/tweet?text="+encodeURIComponent(e)+"&hashtags=MakeTheRightCall"):f="https://twitter.com/search?f=tweets&q=%23MakeTheRightCall%3F";var g=document.getElementById(a);if(g.setAttribute("href",f),GAME.isMobile){var h=document.createEvent("HTMLEvents");h.initEvent("click",!0,!0),g.dispatchEvent(h)}else window.open(f)}};return a}(),GAME.Boot=function(){var a=GAME.Utils,b={preload:function(){GAME.isMobile&&(document.body.className="mobile"),_.stage.backgroundColor="#0b1627",a.loadImages(GAME.preloadbar),GAME.isMobile||(_.scale.maxWidth=GAME.width*GAME.scale,_.scale.maxHeight=GAME.height*GAME.scale),_.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,_.scale.refresh()},create:function(){_.input.maxPointers=1,_.state.start("loading")}};return b}(),GAME.Audio=function(){var a={},b={preload:function(){for(var b in _.cache._cache.sound)a[b]=_.add.audio(b)},play:function(b,c){_.cache.checkSoundKey(b)&&(c&&(a[b].volume=.25),a[b][c?"loopFull":"play"]())}};return b}(),GAME.Timer=function(){var a,b=0,c=!1,d={elapsed:0,add:function(a){b+=a},reset:function(){b=0},pause:function(){c=!c,_.paused=c},tick:function(){b-=1,this.elapsed+=1},format:function(){var a="0"+Math.floor(b/60),c="0"+(b-60*a);return a.substr(-2)+":"+c.substr(-2)},now:function(a){return a?this.format():b},update:function(){0>=b&&GAME.isRunning&&(_.time.events.remove(a),_.events.gameOver.dispatch())},start:function(){a=_.time.events.loop(Phaser.Timer.SECOND,this.tick,this),render=_.time.events.loop(Phaser.Timer.QUARTER,function(){_.events.updateUI.dispatch()},this),this.elapsed=0},init:function(){this.reset(),this.add(30)}};return d}(),GAME.Game=function(){var a=GAME.Utils,b=GAME.Timer,c=[],d={},e={},f=!1,g=300,h={maxOfficers:10,currentOfficers:0,callsHandled:0,createCard:function(){var b=_.add.group(),c=_.add.sprite(_.world.centerX+5,_.world.centerY+10,"card");c.anchor.setTo(.5,.5);var e=_.add.text(_.world.centerX+5,_.world.centerY-15,d.text,a.merge(GAME.fontStyle,{font:"bold 28px Arial",wordWrap:!0,wordWrapWidth:190}));return e.anchor.setTo(.5,0),b.add(c),b.add(e),_.world.sendToBack(b),_.world.moveUp(b),_.world.moveUp(b),b},nextCard:function(){d=a.merge({},c.splice(a.randomRange(0,c.length-1),1)[0]),d.sprite=this.createCard(),this.animateCard(d.sprite)},playCard:function(a){var c;a===d.answer&&(3!==a&&b.add(3),this.callsHandled+=1,_.events.playAudio.dispatch("bell")),1===a?this.currentOfficers-=2:2===a&&(this.currentOfficers-=1),c=a===d.answer?3===a?void 0:!0:void 0,_.events.updateUI.dispatch(c),_.events.flashUI.dispatch("header",a===d.answer),e=d},animateCard:function(a){f=!0;for(var b=0,c=a.children.length;c>b;b++)a.children[b].alpha=0,a.children[b].scale.set(0,0),_.add.tween(a.children[b]).to({alpha:1},g,Phaser.Easing.Quintic.EaseOut,!0),_.add.tween(a.children[b].scale).to({x:1,y:1},g,Phaser.Easing.Quintic.EaseOut,!0);setTimeout(function(){f=!1},g)},moveCard:function(a){var b={};switch(a){case 0:b={x:0,y:-GAME.height};break;case 1:b={x:GAME.height,y:0};break;case 2:b={x:0,y:GAME.height};break;case 3:b={x:-GAME.height,y:0}}_.add.tween(d.sprite.position).to(b,500,Phaser.Easing.Quintic.EaseOut,!0)},handleSwipe:function(a){if(!_.paused&&GAME.isRunning&&!f){if(1===a&&this.currentOfficers<2||2==a&&this.currentOfficers<1)return _.events.flashUI.dispatch("header",!1),void _.events.flashUI.dispatch("footer");this.playCard(a),this.moveCard(a),this.nextCard(),_.events.playAudio.dispatch("swoosh"),c.length||(c=_.cache.getJSON("data").slice(0))}},startTimers:function(){var a=this;GAME.isRunning=!0,b.start(),_.time.events.loop(1e4,function(){a.currentOfficers<a.maxOfficers&&(a.currentOfficers+=1),_.events.updateUI.dispatch()},this)},end:function(){GAME.isRunning=!1;var b=_.add.text(_.world.centerX+5,_.world.centerY,"TIME'S UP!",a.merge(GAME.fontStyle,{font:"bold 80px Arial",fill:"#1B548D",stroke:"#FFFFFF",strokeThickness:10}));b.anchor.setTo(.5,.5),b.scale.set(0,0),_.add.tween(b.scale).to({x:1,y:1},250,Phaser.Easing.Quintic.EaseIn,!0).onComplete.add(function(){setTimeout(function(){_.state.start("game:over")},1500)},this)},create:function(){var a=h;c=_.cache.getJSON("data").slice(0),b.init(),a.callsHandled=0,a.currentOfficers=a.maxOfficers,_.events.initUI.dispatch(),_.events.updateUI.dispatch()}};return h}(),GAME.Input=function(){var a=(GAME.Utils,GAME.Game),b=$("#game"),c={x:0,y:0},d={getTouchPos:function(a,b){var c,d;if(GAME.isMobile&&a.touches){if(a.touches.length>b)return;c=a[b?"touches":"changedTouches"][0].clientX,d=a[b?"touches":"changedTouches"][0].clientY}else c=a.clientX,d=a.clientY;return{x:c,y:d}},down:function(a){c=d.getTouchPos(a,1)},move:function(a){a.preventDefault()},up:function(b){var e=d.getTouchPos(b,0),f=e.x-c.x,g=Math.abs(f),h=e.y-c.y,i=Math.abs(h);(f||h)&&(Math.abs(f)<50&&Math.abs(h)<50||a.handleSwipe(g>i?f>0?1:3:h>0?2:0))},key:function(b){var c={37:3,38:0,39:1,40:2},d=c[b.keyCode];"number"==typeof d&&a.handleSwipe(d)},bind:function(){var a=this;b.addEventListener("mousedown",a.down,!1),b.addEventListener("mousemove",a.move,!1),b.addEventListener("mouseup",a.up,!1),b.addEventListener("touchstart",a.down,!1),b.addEventListener("touchmove",a.move,!1),b.addEventListener("touchend",a.up,!1),b.addEventListener("MSPointerDown",a.down,!1),b.addEventListener("MSPointerMove",a.move,!1),b.addEventListener("MSPointerUp",a.up,!1),b.addEventListener("pointerdown",a.down,!1),b.addEventListener("pointermove",a.move,!1),b.addEventListener("pointerup",a.up,!1),window.addEventListener("keydown",a.key,!1),window.addEventListener("resize",function(){var a=window.innerHeight,c=window.innerHeight<window.innerWidth,d=setInterval(function(){c&&window.innerHeight<a&&(b.style.height=window.innerHeight+"px",b.childNodes[0].style.bottom="auto",clearInterval(d))},500);c||(b.style.height="100%",b.childNodes[0].style.bottom=0)},!1)}};d.bind()}(),GAME.Screens.Loading=function(){var a=GAME.Utils,b={preload:function(){var b={};_.load.script("gray","js/lib/gray.js"),a.loadImages(GAME.backgrounds),_.load.json("data","data.json"),a.loadSounds(GAME.sounds),b.img=_.cache.getImage("preload bar"),b.x=GAME.width/2-b.img.width/2,b.y=GAME.height/2-b.img.height/2,b.sprite=_.add.sprite(b.x,b.y,"preload bar"),_.load.setPreloadSprite(b.sprite)},create:function(){_.state.start("title")}};return b}(),GAME.Screens.Title=function(){var a=!1,b={create:function(){_.add.sprite(0,0,"title");var a=_.add.button(95,595,"play now",function(){_.events.playAudio.dispatch("click"),_.state.start("game:start"),ga("send","event","game play")},this);a.inputEnabled=!0,a.input.useHandCursor=!0;var b=_.add.button(465,595,"hint btn",function(){_.events.playAudio.dispatch("click"),_.state.start("hints")},this);b.inputEnabled=!0,b.input.useHandCursor=!0},update:function(){_.cache.checkSoundKey("office")&&!a&&(_.events.playAudio.dispatch("office",!0),a=!0)}};return b}(),GAME.Screens.Hints=function(){var a={create:function(){_.add.sprite(0,0,"hints");var a=_.add.button(95,595,"play now",function(){_.events.playAudio.dispatch("click"),_.state.start("game:start"),ga("send","event","game play")},this);a.inputEnabled=!0,a.input.useHandCursor=!0}};return a}(),GAME.Screens.Game=function(){var a,b,c,d,e,f,g,h,i=GAME.Utils,j=GAME.Game,k=GAME.Timer,l={header:null,footer:null},m={drawClock:function(){b.clear(),b.lineStyle(0),b.beginFill(49139,.5),k.now()>=60?b.arc(212,40,22,_.math.degToRad(-90),_.math.degToRad(270),!1):30===k.now()?b.arc(212,40,22,_.math.degToRad(90),_.math.degToRad(270),!1):b.arc(212,40,22,_.math.degToRad(-90-6*Math.min(60,k.now())),_.math.degToRad(270),!0),b.endFill()},drawBonus:function(a){var b=_.add.text(242,25,a?"+3":"-1",i.merge(GAME.fontStyle,{fill:"#FFFFFF"}));_.add.tween(b).to({y:0,alpha:0},750,Phaser.Easing.Quintic.EaseOut,!0).onComplete.add(function(){b.destroy()},this)},flash:function(a,b){"header"===a&&l[a].loadTexture("header "+(b?"green":"red"),0,!1),l[a].alpha=1,_.add.tween(l[a]).to({alpha:0},1e3,Phaser.Easing.Quintic.EaseIn,!0)},clearTint:function(){g.filters=null,h.filters=null,j.currentOfficers<2&&(g.filters=[f],j.currentOfficers<1&&(h.filters=[f]))},preload:function(){f=_.add.filter("Gray"),_.add.sprite(0,0,"game bg");var j=_.add.sprite(_.world.centerX+5,_.world.centerY+10,"arrows");j.anchor.setTo(.5,.5);var k=_.add.sprite(_.world.centerX,_.cache.getImage("header bg").height-4,"target bg");k.anchor.setTo(.5,0),g=_.add.sprite(GAME.width,_.world.centerY,"target bg"),g.anchor.setTo(.5,0),g.angle=90,h=_.add.sprite(_.world.centerX,GAME.height-_.cache.getImage("footer bg").height+4,"target bg"),h.anchor.setTo(.5,0),h.angle=180;var n=_.add.sprite(0,_.world.centerY,"target bg");n.anchor.setTo(.5,0),n.angle=270;var o=_.add.text(_.world.centerX,_.cache.getImage("header bg").height+5,"Partner",GAME.fontStyle);o.anchor.setTo(.5,0);var p=_.add.text(GAME.width-3,_.world.centerY,"Deploy officers",GAME.fontStyle);p.anchor.setTo(.5,1),p.angle=270;var q=_.add.text(_.world.centerX-2,GAME.height-_.cache.getImage("footer bg").height,"Resolve on phone",GAME.fontStyle);q.anchor.setTo(.5,1);var r=_.add.text(3,_.world.centerY,"No action",GAME.fontStyle);r.anchor.setTo(.5,1),r.angle=90;var s=_.add.sprite(0,0,"header bg");s.width=GAME.width,l.header=_.add.sprite(0,0,"header red"),l.header.alpha=0,l.header.width=GAME.width;_.add.tileSprite(-8,GAME.height-_.cache.getImage("footer bg").height,GAME.width+8,GAME.height,"footer bg");l.footer=_.add.tileSprite(-8,GAME.height-_.cache.getImage("footer red").height,GAME.width+8,GAME.height,"footer red"),l.footer.alpha=0,a=_.add.text(19,5,"00:00",i.merge(GAME.fontStyle,{font:"bold 60px Arial",align:"left"})),a.anchor.setTo(0,0),b=_.add.graphics(0,0),b.draw=m.drawClock,timeBonus={},timeBonus.draw=m.drawBonus;var t=_.add.text(GAME.width-58,11,"Calls",i.merge(GAME.fontStyle,{align:"left"}));t.anchor.setTo(1,0);var u=_.add.text(GAME.width-19,36,"Handled",i.merge(GAME.fontStyle,{align:"left"}));u.anchor.setTo(1,0),c=_.add.text(GAME.width-130,5,"00",i.merge(GAME.fontStyle,{font:"bold 60px Arial",align:"right"})),c.anchor.setTo(1,0),_.add.sprite(GAME.width-245,17,"caller");_.add.text(_.world.centerX-202,21,"YOU HAVE",i.merge(GAME.fontStyle,{font:"bold 30px Arial"}));e=_.add.text(_.world.centerX+45,21,"OFFICERS",i.merge(GAME.fontStyle,{font:"bold 30px Arial"})),d=_.add.text(_.world.centerX,3,"00",i.merge(GAME.fontStyle,{font:"bold 60px Arial"})),d.anchor.setTo(.5,0)},create:function(){var a=_.add.graphics(0,0);a.lineStyle(2,16777215),a.arc(212,40,22,_.math.degToRad(-90),_.math.degToRad(270),!1);var b=_.add.button(_.world.centerX,_.world.centerY,"start btn",function(){_.events.playAudio.dispatch("click"),j.startTimers(),j.nextCard(),b.destroy()},this);b.anchor.setTo(.5,.5),b.inputEnabled=!0,b.input.useHandCursor=!0},render:function(f){a.setText(k.now(!0)),b.draw(),"undefined"!=typeof f&&timeBonus.draw(f),c.setText(j.callsHandled<10?"0"+j.callsHandled:j.callsHandled),d.fill=j.currentOfficers<=0?"#BB312F":"#FFFFFF",d.setText(j.currentOfficers<10?"0"+j.currentOfficers:j.currentOfficers),e.setText("OFFICER"+(1!==j.currentOfficers?"S":"")),m.clearTint()}};return m}(),GAME.Screens.GameOver=function(){var a=GAME.Utils,b=GAME.Game,c=GAME.Timer,d={create:function(){_.add.sprite(0,0,"gameover"),_.add.text(95,163,"You dealt with "+b.callsHandled+" call"+(1===b.callsHandled?"":"s")+" correctly in "+c.elapsed+" seconds.",a.merge(GAME.fontStyle,{font:"bold 36px Arial",strokeThickness:0}));var e=_.add.button(95,595,"twitter",function(){_.events.playAudio.dispatch("click"),a.share("twitter",b.callsHandled,c.elapsed)},this);e.inputEnabled=!0,e.input.useHandCursor=!0;var f=_.add.button(230,595,"facebook",function(){_.events.playAudio.dispatch("click"),a.share("facebook",b.callsHandled,c.elapsed)},this);f.inputEnabled=!0,f.input.useHandCursor=!0;var g=_.add.button(615,595,"play again",function(){_.events.playAudio.dispatch("click"),_.state.start("title")},this);g.inputEnabled=!0,g.input.useHandCursor=!0}};return d}(),function(){var a=GAME,b=GAME.Screens;window._=new Phaser.Game(GAME.width,GAME.height,Phaser.AUTO,"game"),_.state.add("boot",a.Boot),_.state.add("loading",b.Loading),_.state.add("title",{preload:a.Audio.preload,create:b.Title.create,update:b.Title.update}),_.state.add("hints",{create:b.Hints.create}),_.state.add("game:start",{preload:b.Game.preload,create:a.Game.create,update:a.Timer.update}),_.state.add("game:over",{create:b.GameOver.create}),_.state.start("boot"),_.events={},_.events.initUI=new Phaser.Signal,_.events.initUI.add(b.Game.create),_.events.updateUI=new Phaser.Signal,_.events.updateUI.add(b.Game.render),_.events.flashUI=new Phaser.Signal,_.events.flashUI.add(b.Game.flash),_.events.playAudio=new Phaser.Signal,_.events.playAudio.add(a.Audio.play),_.events.gameOver=new Phaser.Signal,_.events.gameOver.add(a.Game.end)}();
